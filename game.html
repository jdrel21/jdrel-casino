<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>GÄƒseÈ™te bila</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC3wdh4xQDxkk2siLIbtqV1LI_Q9ahrRE8",
  authDomain: "jdrel-casino-f6ea5.firebaseapp.com",
  projectId: "jdrel-casino-f6ea5",
  storageBucket: "jdrel-casino-f6ea5.appspot.com",
  messagingSenderId: "727303157636",
  appId: "1:727303157636:web:5aeb72d5adf7098efe0fd1"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
</script>
</head>

<body>

<header>
  ğŸ¯ GÄƒseÈ™te bila
  <button class="logout" onclick="logout()">Logout</button>
</header>

<main class="game-area">

<button class="start-btn" onclick="startGame()">Start joc</button>

<div class="cups" id="cups">
  <div class="cup"><div class="ball"></div></div>
  <div class="cup"><div class="ball"></div></div>
  <div class="cup"><div class="ball"></div></div>
  <div class="cup"><div class="ball"></div></div>
  <div class="cup"><div class="ball"></div></div>
</div>

<div class="message" id="msg"></div>

</main>

<footer>Joc demo Â· Firebase Â· 18+</footer>

<script>
let cups = [...document.querySelectorAll(".cup")];
let ballIndex = 0;
let playing = false;

auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="index.html";
});

function logout(){
  auth.signOut().then(()=>window.location.href="index.html");
}

function startGame(){
  if(playing) return;
  playing = true;
  msg.innerText = "UrmÄƒreÈ™te bilaâ€¦";

  cups.forEach(c=>{
    c.classList.remove("reveal");
    c.querySelector(".ball").style.display="none";
    c.onclick=null;
  });

  ballIndex = Math.floor(Math.random()*cups.length);
  cups[ballIndex].querySelector(".ball").style.display="block";

  setTimeout(()=>{
    cups[ballIndex].querySelector(".ball").style.display="none";
    shuffle();
  },1000);
}

function shuffle(){
  let moves = 8;
  let i = 0;

  function step(){
    if(i>=moves){
      enablePick();
      msg.innerText="Alege paharul!";
      return;
    }

    let a = Math.floor(Math.random()*cups.length);
    let b = Math.floor(Math.random()*cups.length);
    if(a===b) return step();

    const cupA = cups[a];
    const cupB = cups[b];
    
    if(ballIndex === a) ballIndex = b;
else if(ballIndex === b) ballIndex = a;

    cupA.classList.add("swap-left");
    cupB.classList.add("swap-right");

    setTimeout(()=>{
      cupA.classList.remove("swap-left");
      cupB.classList.remove("swap-right");

      [cups[a],cups[b]]=[cups[b],cups[a]];
      if(ballIndex===a) ballIndex=b;
      else if(ballIndex===b) ballIndex=a;

      cups.forEach(c=>cupsContainer.appendChild(c));
      i++;
      step();
    },270);
  }

  const cupsContainer=document.getElementById("cups");
  step();
}

function enablePick(){
  cups.forEach((cup,i)=>{
    cup.onclick=()=>{
      if(!playing) return;
      playing=false;
      cup.classList.add("reveal");
      cups[ballIndex].querySelector(".ball").style.display="block";
      msg.innerText = (i===ballIndex) ? "ğŸ‰ CÃ‚È˜TIG!" : "âŒ AI PIERDUT";
    }
  });
}
</script>

</body>
</html>
