<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>GÄƒseÈ™te bila</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  ğŸ¯ GÄƒseÈ™te bila
  <div id="coins"></div>
</header>

<button class="logout" onclick="logout()">Logout</button>

<main class="game-area">

  <button class="start-btn" onclick="startGame()">
    Start joc (âˆ’1.000 coins)
  </button>

  <!-- ğŸ”¥ PAHARE -->
  <div class="cups" id="cups">
    <div class="cup"><div class="ball"></div></div>
    <div class="cup"><div class="ball"></div></div>
    <div class="cup"><div class="ball"></div></div>
    <div class="cup"><div class="ball"></div></div>
    <div class="cup"><div class="ball"></div></div>
  </div>

  <div class="message" id="msg"></div>

</main>

<footer>Joc demo Â· FÄƒrÄƒ bani reali Â· 18+</footer>

<!-- ================= SCRIPT JOC ================= -->
<script>
/* ğŸ” PROTECÈšIE LOGIN */
if(localStorage.getItem("logged") !== "true"){
  window.location.href = "index.html";
}

/* ğŸ’° CONFIG */
const START_COINS = 100000;
const BET = 1000;
const WIN = 5000;

/* ğŸ”§ STATE */
let cups = Array.from(document.querySelectorAll(".cup"));
let ballCup = null;
let playing = false;

/* ğŸ’° COINS */
if(!localStorage.getItem("coins")){
  localStorage.setItem("coins", START_COINS);
}
updateCoins();

function updateCoins(){
  document.getElementById("coins").innerText =
    "ğŸ’° Sold: " + localStorage.getItem("coins");
}

/* â–¶ START JOC */
function startGame(){
  if(playing) return;

  let coins = +localStorage.getItem("coins");
  if(coins < BET){
    alert("Nu ai suficiente coins!");
    return;
  }

  localStorage.setItem("coins", coins - BET);
  updateCoins();

  playing = true;
  document.getElementById("msg").innerText = "UrmÄƒreÈ™te bilaâ€¦";

  cups.forEach(c=>{
    c.classList.remove("reveal");
    c.querySelector(".ball").style.display = "none";
    c.onclick = null;
  });

  // AfiÈ™Äƒm bila iniÈ›ial
  const index = Math.floor(Math.random() * cups.length);
  ballCup = cups[index];
  ballCup.querySelector(".ball").style.display = "block";

  setTimeout(()=>{
    ballCup.querySelector(".ball").style.display = "none";
    document.getElementById("msg").innerText = "Amestec pahareleâ€¦";
    shuffle();
  }, 1500);
}

/* ğŸ”„ AMESTECARE REALÄ‚ */
function shuffle(){
  let rounds = 10;
  let i = 0;

  function step(){
    if(i >= rounds){
      document.getElementById("msg").innerText = "Alege paharul!";
      enablePick();
      return;
    }

    let a = Math.floor(Math.random() * cups.length);
    let b = Math.floor(Math.random() * cups.length);
    if(a === b){ step(); return; }

    const cupA = cups[a];
    const cupB = cups[b];

    cupA.classList.add("shake");
    cupB.classList.add("shake");

    setTimeout(()=>{
      const parent = document.getElementById("cups");
      const next = cupA.nextSibling === cupB ? cupA : cupA.nextSibling;
      parent.insertBefore(cupB, cupA);
      parent.insertBefore(cupA, next);

      if(ballCup === cupA) ballCup = cupB;
      else if(ballCup === cupB) ballCup = cupA;

      cups = Array.from(document.querySelectorAll(".cup"));

      cupA.classList.remove("shake");
      cupB.classList.remove("shake");

      i++;
      setTimeout(step, 120);
    }, 300);
  }

  step();
}

/* ğŸ–± CLICK */
function enablePick(){
  cups.forEach(cup=>{
    cup.onclick = ()=> pick(cup);
  });
}

function pick(cup){
  if(!playing) return;
  playing = false;

  cup.classList.add("reveal");
  ballCup.querySelector(".ball").style.display = "block";

  if(cup === ballCup){
    localStorage.setItem("coins",
      +localStorage.getItem("coins") + WIN
    );
    document.getElementById("msg").innerText =
      "ğŸ‰ CÃ‚È˜TIG! +" + WIN + " coins";
  } else {
    document.getElementById("msg").innerText =
      "âŒ Ai pierdut!";
  }

  updateCoins();
}

/* ğŸšª LOGOUT */
function logout(){
  localStorage.removeItem("logged");
  window.location.href = "index.html";
}
</script>

</body>
</html>
